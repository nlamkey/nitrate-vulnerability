
# Nitrate Vulnerability Workflow
This repository is a workflow that processes in-situ nitrate-nitrite readings from a stream source and several types of raster data to determine sources and causes of nitrate-nitrite level fluctuations. 

This workflow is intended to supplement groundwater investigations that are concerned with stream-aquifer interactions. Conceptually, streams and phreatic aquifers exchange water and therefore chemical constituents. This exchange is difficult to quantify and sources and timing of chemical constituent fluctuations aren't always clear. Numerical groundwater flow models can simulate this exchange using background chemical readings, river stage and hydraulic head data but a numerical flow model is only as good as the conceptual model it is based off of. This workflow will provide a robust knowledge base that enhances the conceptual model and provides more detailed information on the inputs and variables supplied to a numerical flow model. 

This workflow aims to understand how some of the surficial processes expressed in remote sensing products (rasters) may or may not be correlated with nitrate-nitrite or other nutrient fluctuations. The final product is a raster containing classified areas where the degree of nitrate-nitrite level fluctuations are shown. 

# Data Requirements 

To run the workflow you will need the following data:

* MODIS Evapotranspiration (HDF)
* MODIS Phenology (HDF)
* PRISM precipitation and temperature (bil)
* gSSURGO gridded soil map (tif)
* Landsat (tif)
* 30m DEM (tif)
* Cropland data layer (tif)
* Landuse and landcover layer (tif)
* In-situ chemistry and discharge data (csv) 
* Model boundaries and site locations (shp)

# Running the Workflow

The workflow is under construction. As of now there is one notebook that processes Landsat and chemistry data. A function is underway that will create a data stack of all the raster data. Random forest will then be applied to classify the data. 

Once completed, the workflow will be a series of notebooks with code that will process the data and the user will need to acquire and structure the data in folders per instructions to come in the final notebooks. 



# Notebooks

All required packages will be added to this repository and list of them will be generated here once the workflow is completed. Here are the ones you need to run the current notebook titled nitrate-study:
```python
import os
from glob import glob
import warnings

import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import geopandas as gpd
import seaborn as sns
import rioxarray as rxr
import xarray as xr
import earthpy as et
import matplotlib.dates as mdates
from matplotlib.dates import DateFormatter
from matplotlib import patches as mpatches, colors
import pyproj
import pylab
import sklearn
from sklearn.linear_model import LinearRegression
import earthpy.mask as em
import earthpy.plot as ep
```
This notebook introduces the AOI and processes Landsat data, chemistry data, and discharge data. The code creates plots of the chemistry and discharge data to assess how the nutrient in question behaves relative to discharge. The two major pieces of information derived are when nutrients enter the stream and whether or not they are coming from a subsurface source or surface source. 

The code also processes Landsat data to create a time series of NDVI. These data are fitted to a linear regression model to assess any immediate relationships with vegetation. 

# Data folder 

Much of the data will be too large to store in a folder so an external hard drive our cloud storage will need to be used to store that data. This folder holds the AOI boundaries, some chemistry data and other small files.


